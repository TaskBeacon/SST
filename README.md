# Stop-Signal Task (PsychoPy)

This code implements a stop-signal task experiment using PsychoPy. The task requires participants to respond to a go stimulus (an arrow) by pressing a corresponding key as quickly as possible. On some trials, a stop signal (a change in the arrow's color or the appearance of an upward arrow) appears after a variable delay, instructing the participant to inhibit their response.

Note: these codes are modified from  https://github.com/cheolsoh/SSTpsychopy

## Function Descriptions:

### `GenTrialSeq(settings)`

* **Purpose:** This function generates the sequence of trials for the entire experiment. It determines whether each trial will be a "go" trial (respond to the arrow) or a "stop" trial (try to inhibit response). It also assigns the direction of the arrow for each trial.
* **Key Settings Used:**
    * `settings.TotalBlocks`: The total number of blocks in the experiment.
    * `settings.TotalTrials`: The total number of trials in the experiment.
    * `settings.TrialsPerBlock`: The number of trials in each block.
    * `settings.arrowTypes`: A list specifying the possible arrow directions (e.g., `[1, 2]` for left and right).
    * `settings.blockSeed`: An optional list of seeds to control the random trial sequence generation for each block.

### `generate_valid_rstims(n_trials, stop_ratio=1/3, max_stop_run=4, min_go_start=3)`

* **Purpose:** This function specifically generates a valid sequence of go (0) and stop (1) trials, ensuring that the proportion of stop trials is close to the specified `stop_ratio` and that certain constraints on the sequence are met.
* **Key Settings Used:**
    * `n_trials`: The total number of trials in the sequence.
    * `stop_ratio`: The desired proportion of stop trials in the sequence (default is 1/3).
    * `max_stop_run`: The maximum number of consecutive stop trials allowed within any 5-trial window. This prevents participants from expecting stop signals too frequently.
    * `min_go_start`: The number of initial trials that must be go trials. This provides participants with some initial practice responding to the go stimulus without the need to stop.

### `generate_arrow_sequence(rstims, arrowTypes)`

* **Purpose:** This function assigns a random arrow direction to each trial in the sequence, based on whether it's a go or a stop trial.
* **Key Settings Used:**
    * `rstims`: The array indicating whether each trial is a go (0) or stop (1) trial (generated by `generate_valid_rstims`).
    * `arrowTypes`: A list specifying the possible arrow directions.

### `Initialize(subdata)`

* **Purpose:** This function initializes the PsychoPy window, creates the visual stimuli (arrows), defines the experiment settings, and sets up the keyboard input.
* **Key Task Settings Defined Here:**
    * `settings.TotalBlocks`: The total number of blocks in the experiment (set to 2).
    * `settings.TotalTrials`: The total number of trials in the experiment (set to 20).
    * `settings.TrialsPerBlock`: The number of trials per block (calculated as `TotalTrials // TotalBlocks`).
    * `settings.arrowTypes`: A list defining the possible arrow directions (either `[1, 2]` for left and right if `settings.twoArrows` is True, or `[2]` for only right if False).
    * `settings.twoArrows`: A boolean flag (default False) to enable or disable the use of both left and right arrows.
    * `settings.useUpArrowStop`: A boolean flag (default False). If True, the stop signal is an upward arrow; otherwise, the go arrow changes color to red.
    * `settings.initSSD`: The initial Stop-Signal Delay (SSD) in milliseconds (set to 200 ms). The SSD is the time between the onset of the go stimulus and the onset of the stop signal.
    * `settings.staircase`: The step size (in milliseconds) used to adjust the SSD based on the participant's stopping performance (set to 50 ms). This implements a staircase procedure to track the participant's stopping ability.
    * `settings.arrowDuration`: The maximum duration (in seconds) for which the go arrow is displayed if no response is made (set to 1 second).
    * `settings.trialDuration`: The total duration of each trial (set to 3 seconds).
    * `settings.left_key`: The key used to respond to a left arrow ('q').
    * `settings.right_key`: The key used to respond to a right arrow ('p').
    * `settings.keyList`: A list of the allowed response keys (`['q', 'p']`).
    * `settings.outfile`: The filename for saving the experimental data.

### `RunTask(win, kb, settings, trialseq, subdata)`

* **Purpose:** This function runs the main experimental loop, presenting trials to the participant, recording their responses, and adjusting the SSD based on their performance in stop trials. It also provides block feedback.
* **Key Task Settings Used:**
    * `settings.initSSD`: Used to initialize the SSD at the beginning of each block.
    * `settings.staircase`: Used to adjust the SSD after each stop trial. The SSD decreases after a failed stop and increases after a successful stop.
    * `settings.arrowDuration`: The maximum time allowed for a response in go trials and the duration to wait after the stop signal in stop trials.
    * `settings.left_key`, `settings.right_key`, `settings.keyList`: Used to handle participant responses.
    * The function also uses the `trialseq` generated by `GenTrialSeq` to determine the trial type and arrow direction for each trial.

### `SetupSeed(settings, subdata, mode="indiv")`

* **Purpose:** This function sets up the random seed strategy for generating the trial sequence, allowing for different levels of randomization (fully random, same for all participants, or individualized based on subject ID).
* **Key Settings Updated:**
    * `settings.GeneralSeed`: The main random seed for the experiment.
    * `settings.blockSeed`: A list of random seeds, one for each block.

### `ShowInstructions(win)`

* **Purpose:** This function displays the task instructions to the participant at the beginning of the experiment.
* **Key Information Presented:** Instructions on how to respond to the go stimulus and what to do when the stop signal appears.

### `SubjectInformation()`

* **Purpose:** This function uses a PsychoPy GUI dialog to collect subject information (Subject ID, Age, Gender, Race) before the start of the experiment.
* **Key Information Collected:** Subject demographic information used for data organization and potential analysis.

### `TerminateTask(win)`

* **Purpose:** This function displays a thank you message to the participant and closes the PsychoPy window, ending the experiment.

### `CountDown(win)`

* **Purpose:** This function (imported from `TaskFunc`) likely displays a countdown timer to the participant before the start of each new block. (The code for this function is not provided in the snippet).

## Key Task Settings:

The most crucial settings that define the task parameters are located within the `Initialize` function. These include:

* **Trial Structure:**
    * `TotalBlocks`: The number of blocks participants will complete.
    * `TotalTrials`: The total number of trials in the entire experiment.
    * `TrialsPerBlock`: The number of trials within each block.
* **Stimuli:**
    * `arrowTypes`: Determines if only one or two arrow directions are used.
    * `twoArrows`: Enables or disables the use of both left and right arrows.
    * `useUpArrowStop`: Determines the visual cue for the stop signal (color change or upward arrow).
* **Timing:**
    * `initSSD`: The starting delay between the go and stop signals.
    * `staircase`: The amount by which the SSD is adjusted after each stop trial, controlling the difficulty of the stopping task.
    * `arrowDuration`: The maximum time the go arrow is visible.
    * `trialDuration`: The total length of each trial.
* **Response Keys:**
    * `left_key`: The key for the left response.
    * `right_key`: The key for the right response.
    * `keyList`: The set of valid response keys.
* **Randomization:**
    * The `SetupSeed` function controls the randomization of the trial sequence based on the chosen mode (random, same, or individual).

These settings can be modified in the `Initialize` function to customize the parameters of the stop-signal task.

## How to Run:

1.  **Prerequisites:** Ensure that you have PsychoPy installed on your system. You can find installation instructions on the official PsychoPy website.
2.  **File Structure:** Make sure that the main script (containing the code you provided, let's assume you save it as `Run.py`) and the `TaskFunc` directory (containing the other Python files like `SetupSeed.py`, `ShowInstructions.py`, etc.) are in the same directory. The import statement `from TaskFunc import *` assumes this structure.
3.  **Open Terminal or Command Prompt:** Open your terminal (on macOS/Linux) or command prompt (on Windows).
4.  **Navigate to the Directory:** Use the `cd` command to navigate to the directory where you saved the `Run.py` file and the `TaskFunc` directory. For example, if your files are in a folder named `sst_task` on your desktop, you would type:
    * **macOS/Linux:** `cd Desktop/sst_task`
    * **Windows:** `cd Desktop\sst_task`
5.  **Run the Script:** Execute the script using the Python interpreter. Type the following command and press Enter:
    ```bash
    python Run.py
    ```
6.  **Follow the Prompts:** The script will then guide you through the following steps:
    * **Subject Information Dialog:** A graphical user interface (GUI) will appear, prompting you to enter the subject's ID, age, gender, and race. Fill in the required information and click "OK". Make sure to follow the validation rules specified in the `SubjectInformation()` function (Subject ID should be a 3-digit integer starting with 1, and Age should be a 2-digit integer greater than or equal to 18).
    * **Instructions:** After confirming the subject information, a screen with task instructions will be displayed. Read the instructions carefully and press the "SPACE" key to continue.
    * **Countdown:** A countdown will appear before the start of the first block of trials.
    * **Task Execution:** The stop-signal task will begin. You will see arrows appear on the screen, and you will need to press the corresponding keys ("q" for left, "p" for right) as quickly as possible. Pay attention to the arrow color; if it turns red (or an upward arrow appears, depending on the settings), you should try to stop your response.
    * **Block Feedback:** After each block of trials is completed, you will see feedback on your performance (mean go reaction time, accuracy, and percentage of successful stops). Press the "SPACE" key to continue to the next block (if there are more blocks) or to proceed after the final block.
    * **Performance Feedback (Optional):** Depending on your stopping performance in a block, you might receive additional feedback before the start of the next block. Press "SPACE" to continue.
    * **Countdown (Between Blocks):** Another countdown will appear before the start of subsequent blocks.
    * **End of Task:** Once all blocks are completed, a "Thanks for your participation!" message will be displayed. Press any key to close the window and terminate the task.
7.  **Data Output:** The experimental data will be saved in a CSV file named `Subject[SubjectID]_[HHMMDDMM].csv` in the same directory where you ran the script. The log file will be saved as `Subject[SubjectID]_[HHMMDDMM].log`.

**Important Notes:**

* Ensure that your monitor is properly calibrated for accurate timing.
* Pay close attention to the instructions provided on the screen during the experiment.
* If you encounter any errors, double-check that you have PsychoPy installed correctly and that the file structure is as described.